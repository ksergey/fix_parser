/**
 * @file   fix_parser_tests.c
 * @author Sergey Kovalevich
 * @date   Created on: 03/07/2018
 */

#include <cassert>
#include <cstdio>
#include <cstring>
#include <fix_parser.h>
#include <fix_parser_priv.h>
#include <fix_msg.h>

int main(int argc, char* argv[])
{
    (void) argc;
    (void) argv;

    FIXError* error = NULL;

    FIXParser* parser = fix_parser_create("test_data/fix3.xml", NULL, PARSER_FLAG_CHECK_ALL, &error);
    assert( parser != NULL );

    char buff[] = "8=FIX.4.4\0019=9907\00135=y\00134=2\00149=EXANTE_TRADE_UAT\00152=20180703-10:22:40.252\00156=DTS8170_TRADE_UAT\001320=123\001322=1\001393=73776\001560=0\001146=50\00155=USO\00148=USO.CBOE.15M2018.C13_5\00122=111\001461=OCXXXX\001200=20180615\001202=13.5\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180615\001711=1\001311=N/A\001309=USO.ARCA\001305=111\00115=USD\00155=AAPL\00148=AAPL.CBOE.22M2018.C215\00122=111\001461=OCXXXX\001200=20180622\001202=215\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180622\001711=1\001311=N/A\001309=AAPL.NASDAQ\001305=111\00115=USD\00155=NFLX\00148=NFLX.CBOE.6N2018.C250\00122=111\001461=OCXXXX\001200=20180706\001202=250\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180706\001711=1\001311=N/A\001309=NFLX.NASDAQ\001305=111\00115=USD\00155=PZRXQ\00148=PZRXQ.OTCMKTS\00122=111\001461=EXXXXX\001231=1\001207=OTCMKTS\001870=3\001871=500\001872=0.0001\001871=503\001872=0.0001\001871=504\001872=1.0\00115=USD\00155=OESX\00148=OESX.EUREX.21Z2018.P3425\00122=111\001461=OPXXXX\001200=20181221\001202=3425\001231=10\001207=EUREX\001870=4\001871=500\001872=0.1\001871=503\001872=0.1\001871=504\001872=1.0\001871=505\001872=20181221\001711=1\001311=N/A\001309=SX5E.INDEX\001305=111\00115=EUR\00155=B\00148=B.ICE.Z2018.C82\00122=111\001461=OCXXXX\001200=201812\001202=82\001231=1000\001207=ICE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20181026\001711=1\001311=N/A\001309=B.ICE.Z2018\001305=111\00115=USD\00155=XOP\00148=XOP.CBOE.17Q2018.C41\00122=111\001461=OCXXXX\001200=20180817\001202=41\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180817\001711=1\001311=N/A\001309=XOP.ARCA\001305=111\00115=USD\00155=RTN\00148=RTN.CBOE.13N2018.P182_5\00122=111\001461=OPXXXX\001200=20180713\001202=182.5\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180713\001711=1\001311=N/A\001309=RTN.NYSE\001305=111\00115=USD\00155=HCA\00148=HCA.NYSE\00122=111\001461=EXXXXX\001231=1\001207=NYSE\001870=3\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\00115=USD\00155=QQQ\00148=QQQ.CBOE.13N2018.P161\00122=111\001461=OPXXXX\001200=20180713\001202=161\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180713\001711=1\001311=N/A\001309=QQQ.NASDAQ\001305=111\00115=USD\00155=XLE\00148=XLE.CBOE.21Z2018.C74\00122=111\001461=OCXXXX\001200=20181221\001202=74\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20181221\001711=1\001311=N/A\001309=XLE.ARCA\001305=111\00115=USD\00155=MCFT\00148=MCFT.NASDAQ\00122=111\001461=EXXXXX\001231=1\001207=NASDAQ\001870=3\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\00115=USD\00155=UVXY\00148=UVXY.CBOE.15M2018.C5\00122=111\001461=OCXXXX\001200=20180615\001202=5\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180615\001711=1\001311=N/A\001309=UVXY.ARCA\001305=111\00115=USD\00155=XLK\00148=XLK.CBOE.22M2018.P59_5\00122=111\001461=OPXXXX\001200=20180622\001202=59.5\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180622\001711=1\001311=N/A\001309=XLK.ARCA\001305=111\00115=USD\00155=OESX\00148=OESX.EUREX.17Q2018.C3275\00122=111\001461=OCXXXX\001200=20180817\001202=3275\001231=10\001207=EUREX\001870=4\001871=500\001872=0.1\001871=503\001872=0.1\001871=504\001872=1.0\001871=505\001872=20180817\001711=1\001311=N/A\001309=SX5E.INDEX\001305=111\00115=EUR\00155=UNH\00148=UNH.CBOE.13N2018.C215\00122=111\001461=OCXXXX\001200=20180713\001202=215\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180713\001711=1\001311=N/A\001309=UNH.NYSE\001305=111\00115=USD\00155=FXE\00148=FXE.CBOE.18F2019.P104\00122=111\001461=OPXXXX\001200=20190118\001202=104\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20190118\001711=1\001311=N/A\001309=FXE.ARCA\001305=111\00115=USD\00155=EFZ\00148=EFZ.ARCA\00122=111\001461=EXXXXX\001231=1\001207=ARCA\001870=3\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\00115=USD\00155=SPXW\00148=SPXW.CBOE.15M2018.P1075\00122=111\001461=OPXXXX\001200=20180615\001202=1075\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180615\001711=1\001311=N/A\001309=SPX.INDEX\001305=111\00115=USD\00155=OJ\00148=OJ.ICE.X2018.P170\00122=111\001461=OPXXXX\001200=201811\001202=170\001231=150\001207=ICE\001870=4\001871=500\001872=0.05\001871=503\001872=0.05\001871=504\001872=1.0\001871=505\001872=20181019\001711=1\001311=N/A\001309=OJ.ICE.X2018\001305=111\00115=USD\00155=B\00148=B.ICE.Q2018.C73_25\00122=111\001461=OCXXXX\001200=201808\001202=73.25\001231=1000\001207=ICE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180626\001711=1\001311=N/A\001309=B.ICE.Q2018\001305=111\00115=USD\00155=GOOGL\00148=GOOGL.CBOE.20N2018.P1185\00122=111\001461=OPXXXX\001200=20180720\001202=1185\001231=100\001207=CBOE\001870=4\001871=500\001872=0.05\001871=503\001872=0.05\001871=504\001872=1.0\001871=505\001872=20180720\001711=1\001311=N/A\001309=GOOGL.NASDAQ\001305=111\00115=USD\00155=CT\00148=CT.ICE.N2018.C65\00122=111\001461=OCXXXX\001200=201807\001202=65\001231=500\001207=ICE\001870=5\001871=500\001872=0.01\001871=501\001872=1430.0\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180615\001711=1\001311=N/A\001309=CT.ICE.N2018\001305=111\00115=USD\00155=AAPL\00148=AAPL.CBOE.20N2018.P85\00122=111\001461=OPXXXX\001200=20180720\001202=85\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180720\001711=1\001311=N/A\001309=AAPL.NASDAQ\001305=111\00115=USD\00155=VRX\00148=VRX.CBOE.18F2019.P40\00122=111\001461=OPXXXX\001200=20190118\001202=40\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20190118\001711=1\001311=N/A\001309=VRX.NYSE\001305=111\00115=USD\00155=AMZN\00148=AMZN.CBOE.18F2019.P1480\00122=111\001461=OPXXXX\001200=20190118\001202=1480\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20190118\001711=1\001311=N/A\001309=AMZN.NASDAQ\001305=111\00115=USD\00155=GE\00148=GE.CBOE.18F2019.P42\00122=111\001461=OPXXXX\001200=20190118\001202=42\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20190118\001711=1\001311=N/A\001309=GE.NYSE\001305=111\00115=USD\00155=CO\00148=CO.ICE.Z2018.C3400\00122=111\001461=OCXXXX\001200=201812\001202=3400\001231=10\001207=ICE\001870=4\001871=500\001872=1.0\001871=503\001872=1.0\001871=504\001872=1.0\001871=505\001872=20181102\001711=1\001311=N/A\001309=CC.ICE.Z2018\001305=111\00115=USD\00155=IWM\00148=IWM.CBOE.28U2018.C120\00122=111\001461=OCXXXX\001200=20180928\001202=120\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180928\001711=1\001311=N/A\001309=IWM.ARCA\001305=111\00115=USD\00155=XLF\00148=XLF.CBOE.18F2019.P26\00122=111\001461=OPXXXX\001200=20190118\001202=26\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20190118\001711=1\001311=N/A\001309=XLF.ARCA\001305=111\00115=USD\00155=GMD\00148=GMD.LSE\00122=111\001461=EXXXXX\001231=1\001207=LSE\001870=3\001871=500\001872=0.0001\001871=503\001872=0.0001\001871=504\001872=1.0\00115=GBP\00155=AMZN\00148=AMZN.CBOE.21U2018.P1570\00122=111\001461=OPXXXX\001200=20180921\001202=1570\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180921\001711=1\001311=N/A\001309=AMZN.NASDAQ\001305=111\00115=USD\00155=NRZ\00148=NRZ.CBOE.17Q2018.C18\00122=111\001461=OCXXXX\001200=20180817\001202=18\001231=100\001207=CBOE\001870=4\001871=500\001872=0.05\001871=503\001872=0.05\001871=504\001872=1.0\001871=505\001872=20180817\001711=1\001311=N/A\001309=NRZ.NYSE\001305=111\00115=USD\00155=QQQ\00148=QQQ.CBOE.17Q2018.C170\00122=111\001461=OCXXXX\001200=20180817\001202=170\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180817\001711=1\001311=N/A\001309=QQQ.NASDAQ\001305=111\00115=USD\00155=CVRR\00148=CVRR.NYSE\00122=111\001461=EXXXXX\001231=1\001207=NYSE\001870=3\001871=500\001872=0.05\001871=503\001872=0.05\001871=504\001872=1.0\00115=USD\00155=TSLA\00148=TSLA.CBOE.17F2020.C60\00122=111\001461=OCXXXX\001200=20200117\001202=60\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20200117\001711=1\001311=N/A\001309=TSLA.NASDAQ\001305=111\00115=USD\00155=XLF\00148=XLF.CBOE.28U2018.P34\00122=111\001461=OPXXXX\001200=20180928\001202=34\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180928\001711=1\001311=N/A\001309=XLF.ARCA\001305=111\00115=USD\00155=ALGN\00148=ALGN.CBOE.17Q2018.P470\00122=111\001461=OPXXXX\001200=20180817\001202=470\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180817\001711=1\001311=N/A\001309=ALGN.NASDAQ\001305=111\00115=USD\00155=BAC\00148=BAC.CBOE.20N2018.P29\00122=111\001461=OPXXXX\001200=20180720\001202=29\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180720\001711=1\001311=N/A\001309=BAC.NYSE\001305=111\00115=USD\00155=N225\00148=N225.OE.7M2018.P19250\00122=111\001461=OPXXXX\001200=20180607\001202=19250\001231=1000\001207=OE\001870=4\001871=500\001872=1.0\001871=503\001872=1.0\001871=504\001872=1.0\001871=505\001872=20180607\001711=1\001311=N/A\001309=N225.INDEX\001305=111\00115=JPY\00155=MON\00148=MON.CBOE.18F2019.P105\00122=111\001461=OPXXXX\001200=20190118\001202=105\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180607\001711=1\001311=N/A\001309=MON.NYSE\001305=111\00115=USD\00155=ESX\00148=ESX.LIFFE.U2018.C7875\00122=111\001461=OCXXXX\001200=201809\001202=7875\001231=10\001207=LIFFE\001870=4\001871=500\001872=0.5\001871=503\001872=0.5\001871=504\001872=1.0\001871=505\001872=20180921\001711=1\001311=N/A\001309=Z.LIFFE.U2018\001305=111\00115=GBP\00155=WMT\00148=WMT.CBOE.8M2018.C87_5\00122=111\001461=OCXXXX\001200=20180608\001202=87.5\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180608\001711=1\001311=N/A\001309=WMT.NYSE\001305=111\00115=USD\00155=MBUU\00148=MBUU.NASDAQ\00122=111\001461=EXXXXX\001231=1\001207=NASDAQ\001870=3\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\00115=USD\00155=SPY\00148=SPY.CBOE.22M2018.C245\00122=111\001461=OCXXXX\001200=20180622\001202=245\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180622\001711=1\001311=N/A\001309=SPY.ARCA\001305=111\00115=USD\00155=AMZN\00148=AMZN.CBOE.21U2018.P1660\00122=111\001461=OPXXXX\001200=20180921\001202=1660\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180921\001711=1\001311=N/A\001309=AMZN.NASDAQ\001305=111\00115=USD\00155=JWN\00148=JWN.CBOE.18F2019.P65\00122=111\001461=OPXXXX\001200=20190118\001202=65\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20190118\001711=1\001311=N/A\001309=JWN.NYSE\001305=111\00115=USD\00155=NFLX\00148=NFLX.CBOE.6N2018.C347_5\00122=111\001461=OCXXXX\001200=20180706\001202=347.5\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180706\001711=1\001311=N/A\001309=NFLX.NASDAQ\001305=111\00115=USD\00155=SPX\00148=SPX.CBOE.21Z2018.C250\00122=111\001461=OCXXXX\001200=20181221\001202=250\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20181221\001711=1\001311=N/A\001309=SPX.INDEX\001305=111\00115=USD\00155=GE\00148=GE.CBOE.3Q2018.C16\00122=111\001461=OCXXXX\001200=20180803\001202=16\001231=100\001207=CBOE\001870=4\001871=500\001872=0.01\001871=503\001872=0.01\001871=504\001872=1.0\001871=505\001872=20180803\001711=1\001311=N/A\001309=GE.NYSE\001305=111\00115=USD\00110=146\001";
    char const* stop = NULL;
    FIXMsg* msg = fix_parser_str_to_msg(parser, buff, strlen(buff), FIX_SOH, &stop, &error);
    if (!msg) {
        printf("error %d %s\n", error->code, fix_error_get_text(error));
        //printf("%x %x %d\n", buff, stop, (int)(stop - buff));
    } else {
        uint32_t reqBuffLen = 0;
        char data[1024 * 1024];
        if (fix_msg_to_str(msg, '|', data, sizeof(data), &reqBuffLen, &error) != FIX_SUCCESS) {
            printf("serialize error %d %s\n", error->code, fix_error_get_text(error));
        } else {
            printf("%.*s\n", (int) reqBuffLen, data);
        }
    }

    return EXIT_SUCCESS;
}
